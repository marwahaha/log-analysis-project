
# Log Analysis Project
This is the source code for a python script for a **news website** request log analysis.
In this version of the program three reports are generated. Each report is intended to answer one of the following questions:

1) **What are the most popular articles at all times?**
2) **What are the most popular authors of articles at all times?**
3) **What are the days in which more than 1% of the total access resulted in errors?**

## Project Structure
```
|-- database                        // Scripts to setup the database
    |-- dbConf.sh                   // Run the database/views creation scripts 
    |-- newsdata.sql                // Creates de database with data
    |-- views.sql                   // Creates views to be used on reports creation
|-- reports                         // Reports folder            
|-- reports.py                      // Main python script to generate reports
|-- reports_db_helper.py            // Helper for database queries
|-- reports_file_helper.py          // Helper for the reports generation
|-- Vagrantfile                     // Vagrant configuration file
|-- README.md
```

## Requirements
This project runs on a Vitual Box Machine managed with Vagrant. Please, make sure you have both Virtual Box and Vagrant installed before proceeding with the project installation:
* [Virtual Box](https://www.virtualbox.org/wiki/Downloads)
* [Vagrant](https://www.vagrantup.com/downloads.html)

## Database
The reports are generated by running sql queries on the **news database**. This section presents the news database **tables structure**:

### articles

| Column        | Type           | Description  |
| ------------- |:-------------:| -----|
| author      | integer | A foreign key to the authors identification in the authors database |
| title      | text      |   The article's title |
| slug | text      |    An abreviation of the article's title |
| lead | text      |    An abstract of the article's content |
| body | text      |    The article's content |
| time | timestamp with time zone      |    The date of publication |
| id | integer      |    The article's identification within the system |

### authors

| Column        | Type           | Description  |
| ------------- |:-------------:| -----|
| name      | text | The author's full name |
| bio      | text | The author's brief biography |
| id      | integer | The author's identification within the database |

### log
| Column        | Type           | Description  |
| ------------- |:-------------:| -----|
| path      | text | The website section accessed e.g: /articles/[ARTICLE_NAME] |
| ip      | inet | The ip address of the user that performed the request |
| method      | text | The HTTP Method used to access e.g: GET |
| status      | text | The HTTP request status e.g: 200 OK |
| time      | timestamp with time zone | The request date  |
| id      | integer | The log identification within the database |

## Installation
1) Please **clone** the project's repository running the following command on a **terminal**:
```
git clone https://github.com/thiagothalison1/log-analysis-project.git
```
2) Setup Virtual Machine:
```
vagrant up
```
**Note**: This command may take a while to execute because it will download a linux distribution to be run on Virtual Box. Also, it will install the necessary dependencies to run the project.

3) Create the **news** database and the **views** to be used on the reports generation. Please, run the following commands on a terminal:

* Open a terminal connected with the VM:
```
vagrant ssh
```
* Change to vagrant directory:
```
cd /vagrant
```
* Unzip the environment scripts into environment folder:
```
unzip ./environment/environment.zip -d ./environment/
```
* Run a script to create the news database and views:
```
. ./environment/dbConf.sh
```

**Note**: Three views are used on the reports generation, you can find out the sql commands to create the views at: `environment/views.sql`

## Execution
To execute the project, please run the following command on a terminal:
```
python reports.py
```
**NOTE**: A reports folder will be created on the projects root directory (`/vagrant` on the VM). There will be three reports, one per question.
* Question 1: <log-analysis-project>/reports/report_popular_articles.txt
* Question 2: - <log-analysis-project>/reports/report_popular_authors.txt
* Question 3: - <log-analysis-project>/reports/report_risk_days.txt

## License
This project is distributed under [MIT License](https://opensource.org/licenses/MIT)
